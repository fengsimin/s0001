<?php
//Copyright (c) 2016 iFeiwu.com
 class Uploader extends Ifeiwu { function __construct() { } protected function postImage($request_data) { goto DMbKm; Xkn1a: if (!$handle->uploaded) { goto xevqK; } goto E2zKd; M80pJ: if (!($file_save_path == "\57")) { goto BkEQ3; } goto sxB1F; Qv5Yg: gI9zF: goto MiRrA; JIO_h: return $this->error("\346\227\xa0\xe6\225\210\347\232\204\346\x96\207\xe4\xbb\266\344\xbf\xa1\346\201\xaf\xef\xbc\x81"); goto HLwr7; cnJx9: $handle->Process($upload_root . "\x2f" . $file_save_path); goto hi_YD; Wo7Sc: F01i0: goto M80pJ; iNKIg: $file_save_path = $_POST["\146\151\x6c\x65\137\163\141\x76\145\x5f\160\x61\x74\x68"]; goto i0fQa; GG0pW: return $this->success('', array("\160\141\x74\150" => $file_save_path, "\x69\x6d\141\147\x65" => $handle->file_dst_name, "\x73\x69\x7a\x65" => $handle->file_src_size, "\x77\x69\x64\164\x68" => $handle->image_src_x, "\150\x65\151\147\x68\164" => $handle->image_src_y, "\164\x79\x70\145" => $handle->image_dst_type, "\145\170\164" => $handle->file_dst_name_ext)); goto fl0H4; jnJ4N: $handle->file_new_name_body = $file_new_name_body; goto xRbgb; AJfps: if ($image_resize == 1) { goto Hdl0k; } goto THLCh; cCJ85: $_FILES["\146\x69\x6c\145"]["\164\171\160\145"] = $_POST["\x66\x69\x6c\x65\x5f\x74\171\160\x65"]; goto Jcko2; AypMC: $file_name_body_pre = explode("\x2c", $_POST["\x66\x69\154\x65\x5f\x6e\x61\x6d\145\137\142\x6f\144\x79\137\160\x72\x65"]); goto eLbGK; i0fQa: $image_convert = $_POST["\x69\x6d\x61\147\x65\x5f\143\x6f\156\166\145\162\x74"]; goto MKOYO; lC5fB: v0HWq: goto n7n89; P271B: goto nkkcH; goto Wo7Sc; fl0H4: nkkcH: goto w593A; sxB1F: $file_save_path = ''; goto U4eKk; nK0Ke: XFZ_M: goto a9csB; ZyDGq: $_FILES["\x66\151\x6c\x65"]["\x65\162\x72\157\162"] = $_POST["\x66\x69\154\x65\x5f\x65\x72\162\157\162"]; goto VHfny; Jcko2: $_FILES["\x66\x69\154\x65"]["\163\151\172\145"] = $_POST["\146\x69\x6c\x65\x5f\x73\x69\172\x65"]; goto ZyDGq; DMbKm: $_FILES["\146\151\x6c\x65"]["\156\141\155\145"] = $_POST["\x66\x69\x6c\145\137\156\141\155\x65"]; goto cCJ85; ZKgHQ: return $this->error($handle->log); goto P271B; M8zpH: $image_y = explode("\54", $_POST["\x69\155\x61\x67\145\x5f\171"]); goto gyKo5; n7n89: ifeiwu\Loader::import("\x65\170\164\x65\x6e\144\57\125\160\x6c\157\x61\x64"); goto LpySr; U4eKk: BkEQ3: goto GG0pW; O7r9H: $handle->image_convert = $image_convert; goto N3UOd; xe1aj: if (!$file_new_name_body) { goto k3f2i; } goto jnJ4N; OoCIl: xevqK: goto cI3BT; E2zKd: $upload_root = "\56\x2e\x2f"; goto z5ij4; MiRrA: if (!$image_convert) { goto U20sd; } goto O7r9H; a9csB: Bxsf3: goto OoCIl; EDtBC: if (!$quality) { goto gI9zF; } goto tPaTJ; tPaTJ: $handle->jpeg_quality = $quality; goto Qv5Yg; cI3BT: if ($handle->processed) { goto F01i0; } goto ZKgHQ; MKOYO: $jpeg_quality = explode("\54", $_POST["\x6a\x70\145\x67\137\161\165\141\154\151\x74\171"]); goto AJfps; HLwr7: goto RGLEf; goto lC5fB; xRbgb: k3f2i: goto Vqgui; z5ij4: $file_new_name_body = $_POST["\x66\151\x6c\145\x5f\x6e\145\167\x5f\x6e\x61\155\x65\x5f\142\x6f\x64\x79"]; goto nhcqT; nhcqT: $file_overwrite = $_POST["\146\x69\x6c\145\137\x6f\166\145\x72\167\x72\151\164\145"]; goto F06Ha; THLCh: $quality = end($jpeg_quality); goto EDtBC; LpySr: $handle = new Upload($_FILES["\x66\x69\x6c\x65"]); goto Xkn1a; N3UOd: U20sd: goto xe1aj; hi_YD: goto Bxsf3; goto Pjlbp; eLbGK: $image_x = explode("\54", $_POST["\x69\155\141\x67\145\137\x78"]); goto M8zpH; Vqgui: $handle->file_overwrite = $file_overwrite ? true : false; goto cnJx9; F06Ha: $image_resize = $_POST["\x69\x6d\141\x67\145\137\162\x65\163\x69\172\145"]; goto iNKIg; VHfny: if (!empty($_FILES["\x66\x69\154\145"])) { goto v0HWq; } goto JIO_h; gyKo5: foreach ($file_name_body_pre as $key => $prefix) { goto Kxd1h; tJKtX: Tc_8Z: goto w0Rbu; rhXeI: $height = $image_y[$key]; goto wu_Ud; pxBla: if (!$quality) { goto LgaoI; } goto JTKwV; Kxd1h: $width = $image_x[$key]; goto rhXeI; T8R_u: if (!$image_convert) { goto x826C; } goto DNs5a; wLQmM: WhFA5: goto MQtRY; HLcbQ: $handle->image_ratio_y = true; goto STt30; w0Rbu: $handle->file_overwrite = $file_overwrite ? true : false; goto F9_tm; JTKwV: $handle->jpeg_quality = $quality; goto AG6UU; gJ5Oy: rpGCb: goto Y7hyC; FXz3k: Pxjlp: goto O5kgw; POVAm: $handle->image_x = $handle->image_src_x; goto uBT6Z; uBT6Z: goto Pxjlp; goto FSbWb; DNs5a: $handle->image_convert = $image_convert; goto mH0pg; HOAMO: if ($width && $handle->image_src_x > $width) { goto ZMXEx; } goto POVAm; FzrdM: $handle->image_resize = $image_resize ? true : false; goto RRVKx; AG6UU: LgaoI: goto T8R_u; KX0xi: $handle->file_new_name_body = $file_new_name_body; goto tJKtX; cqLc7: $handle->image_x = $width; goto FXz3k; UnOwI: Wenbk: goto wE9zL; RRVKx: $handle->file_name_body_pre = $prefix; goto TVwBK; wE9zL: $handle->image_y = $height; goto wLQmM; STt30: goto WhFA5; goto UnOwI; MQtRY: if (!$file_new_name_body) { goto Tc_8Z; } goto KX0xi; THFNE: if (!$prefix) { goto P8QkQ; } goto FzrdM; wu_Ud: $quality = $jpeg_quality[$key]; goto THFNE; F9_tm: $handle->Process($upload_root . "\x2f" . $file_save_path); goto gJ5Oy; FSbWb: ZMXEx: goto cqLc7; O5kgw: if ($height && $handle->image_src_y > $height) { goto Wenbk; } goto HLcbQ; TVwBK: P8QkQ: goto pxBla; mH0pg: x826C: goto HOAMO; Y7hyC: } goto nK0Ke; Pjlbp: Hdl0k: goto AypMC; w593A: RGLEf: goto o3X1R; o3X1R: } protected function postFile($request_data) { goto XR16a; M2mBP: $dest_file = $temp_dir . "\x2f" . $resumableFilename . "\56\x70\141\162\x74" . $resumableChunkNumber; goto KYpd6; sASI9: q6K9a: goto iTgSn; b60eU: $resumableIdentifier = $_POST["\162\x65\x73\x75\x6d\141\142\x6c\x65\x49\144\x65\156\164\151\x66\x69\145\162"]; goto sB5rO; HBXcC: Rm3yH: goto ZYHvN; iTgSn: if (!move_uploaded_file($file["\x74\155\x70\x5f\156\x61\x6d\x65"], $dest_file)) { goto Rm3yH; } goto BbheJ; ljVzk: if (!($file["\145\x72\162\x6f\162"] != 0)) { goto lRWh3; } goto jXqNW; M8ZYe: $_FILES["\146\x69\x6c\145"]["\145\162\x72\x6f\x72"] = $_POST["\146\151\x6c\145\137\145\x72\162\157\162"]; goto cVsqN; jXqNW: $this->_debug("\x65\x72\162\157\x72\40" . $file["\145\162\162\157\x72"] . "\40\151\156\40\x66\x69\x6c\x65\x20" . $resumableFilename); goto GLaFC; GLaFC: lRWh3: goto gAqLU; gAqLU: $temp_dir = $save_path . "\x2f" . $resumableIdentifier; goto M2mBP; D2Ld_: goto JOIsx; goto HBXcC; sB5rO: $_FILES["\x66\x69\x6c\145"]["\x6e\x61\155\x65"] = $_POST["\146\151\x6c\x65\137\156\x61\155\x65"]; goto ijG3X; BbheJ: $this->_createFileFromChunks($save_path, $temp_dir, $resumableFilename, $_POST["\x72\145\163\x75\x6d\x61\x62\x6c\145\103\150\x75\156\x6b\123\151\x7a\145"], $_POST["\x72\x65\x73\x75\x6d\141\142\154\145\x54\x6f\x74\141\x6c\x53\151\172\145"]); goto D2Ld_; LWFbd: $_FILES["\x66\151\154\145"]["\163\x69\172\145"] = $_POST["\x66\x69\x6c\x65\x5f\163\x69\172\145"]; goto M8ZYe; U2QsM: mkdir($temp_dir, 511, true); goto sASI9; KYpd6: if (is_dir($temp_dir)) { goto q6K9a; } goto U2QsM; DDAyn: $resumableFilename = $this->_UTF82GBK($_POST["\x72\x65\x73\165\x6d\141\142\154\145\106\151\x6c\145\156\x61\155\x65"]); goto YBBAr; ijG3X: $_FILES["\146\151\154\145"]["\164\171\160\145"] = $_POST["\x66\151\x6c\145\x5f\x74\171\x70\145"]; goto LWFbd; XR16a: $save_path = "\x2e\x2e\x2f" . $this->_UTF82GBK($_POST["\x73\141\166\x65\x5f\x70\x61\164\150"]); goto DDAyn; cVsqN: $file = $_FILES["\x66\x69\x6c\145"]; goto ljVzk; i5QKK: JOIsx: goto bkC9x; YBBAr: $resumableChunkNumber = $_POST["\x72\x65\163\165\x6d\x61\x62\x6c\145\x43\x68\165\156\153\116\x75\x6d\x62\145\162"]; goto b60eU; ZYHvN: $this->_debug("\105\x72\162\x6f\162\40\x73\x61\x76\151\x6e\147\x20\50\155\x6f\x76\145\137\x75\160\154\157\141\x64\145\x64\x5f\146\x69\154\145\x29\x20\x63\x68\165\x6e\153\40" . $resumableChunkNumber . "\40\x66\157\x72\x20\146\151\154\145\40" . $resumableFilename); goto i5QKK; bkC9x: } protected function getFile() { goto wUbrh; v6liK: gVeIf: goto g3arJ; PeDPa: $resumableChunkNumber = $_GET["\162\x65\x73\165\155\141\142\x6c\x65\103\x68\165\x6e\x6b\116\165\x6d\142\x65\x72"]; goto RMpIS; wUbrh: $save_path = "\x2e\x2e\x2f" . $this->_UTF82GBK($_GET["\x73\x61\166\x65\x5f\160\141\164\x68"]); goto H35cv; vX7tP: $temp_dir = $save_path . "\x2f" . $resumableIdentifier; goto kuxWr; H35cv: $resumableFilename = $this->_UTF82GBK($_GET["\162\x65\x73\x75\155\141\x62\154\x65\106\151\154\145\156\x61\x6d\x65"]); goto PeDPa; g3arJ: return 202; goto fy54a; rj2Ns: goto PiZKp; goto v6liK; RMpIS: $resumableIdentifier = $_GET["\x72\x65\163\x75\155\x61\142\x6c\145\111\x64\145\x6e\x74\151\146\x69\x65\162"]; goto vX7tP; kuxWr: $chunk_file = $temp_dir . "\57" . $resumableFilename . "\x2e\x70\x61\162\164" . $resumableChunkNumber; goto B7THu; sUklQ: return 404; goto rj2Ns; fy54a: PiZKp: goto kThBy; B7THu: if (file_exists($chunk_file)) { goto gVeIf; } goto sUklQ; kThBy: } private function _createFileFromChunks($save_path, $temp_dir, $fileName, $chunkSize, $totalSize) { goto HI1qm; HI1qm: $total_files = 0; goto tsOq6; DWcW2: $this->_rrmdir($temp_dir); goto Do67Z; UaQDS: $this->_rrmdir($temp_dir . "\137\x55\x4e\125\123\x45\104"); goto xgJF6; zl40t: if (!($i <= $total_files)) { goto j5a2O; } goto kOGCq; xgJF6: Mb_Kj: goto Hch0o; X0O9N: if (rename($temp_dir, $temp_dir . "\x5f\125\116\125\123\105\104")) { goto LSN1s; } goto DWcW2; qpzMW: goto FYJEe; goto L7cpX; kmQxV: FYJEe: goto X0O9N; Do67Z: goto Mb_Kj; goto TaYIz; Gmf6j: $i = 1; goto dt2LI; Hch0o: y4CmZ: goto k7Pya; kOGCq: fwrite($fp, file_get_contents($temp_dir . "\x2f" . $fileName . "\x2e\x70\141\x72\164" . $i)); goto v6zOw; oSfMr: if (!($total_files * $chunkSize >= $totalSize - $chunkSize + 1)) { goto y4CmZ; } goto jzFhW; L7cpX: YQjwL: goto Gmf6j; jzFhW: if (($fp = fopen($save_path . "\x2f" . $fileName, "\x77")) !== false) { goto YQjwL; } goto ykGXV; aKKZz: PIzEP: goto oSfMr; ykGXV: $this->_debug("\x63\x61\156\156\x6f\164\40\x63\x72\145\x61\x74\x65\40\x74\x68\145\x20\144\145\x73\x74\151\156\x61\164\151\157\156\x20\x66\x69\x6c\x65"); goto aKwgd; zoD7R: $i++; goto tcu1c; tcu1c: goto Ke3IA; goto NHYLz; aKwgd: return false; goto qpzMW; v6zOw: jWLoI: goto zoD7R; dt2LI: Ke3IA: goto zl40t; K3Crf: fclose($fp); goto kmQxV; NHYLz: j5a2O: goto K3Crf; tsOq6: foreach (scandir($temp_dir) as $file) { goto enWtc; Xfgz7: $total_files++; goto Hkc7k; GLhu8: IJN0m: goto XSJ5q; enWtc: if (!(stripos($file, $fileName) !== false)) { goto Yef1I; } goto Xfgz7; Hkc7k: Yef1I: goto GLhu8; XSJ5q: } goto aKKZz; TaYIz: LSN1s: goto UaQDS; k7Pya: } private function _rrmdir($dir) { goto sEI2K; h9K5I: foreach ($objects as $object) { goto EvN0l; Crk6O: if (filetype($dir . "\57" . $object) == "\144\151\162") { goto YETsL; } goto QW3A9; WHVb_: EsxHy: goto IgFby; Cozvs: Frx_W: goto VJq1n; EvN0l: if (!($object != "\56" && $object != "\x2e\56")) { goto JhHZP; } goto Crk6O; QW3A9: unlink($dir . "\57" . $object); goto ZZvMo; IgFby: JhHZP: goto Cozvs; ZZvMo: goto EsxHy; goto O2AuZ; nnbKd: $this->_rrmdir($dir . "\57" . $object); goto WHVb_; O2AuZ: YETsL: goto nnbKd; VJq1n: } goto pJoD6; d9bAZ: QYEmO: goto C2_V9; xOWqW: $objects = scandir($dir); goto h9K5I; pJoD6: W7fTT: goto QQ6o0; N35DV: rmdir($dir); goto d9bAZ; QQ6o0: reset($objects); goto N35DV; sEI2K: if (!is_dir($dir)) { goto QYEmO; } goto xOWqW; C2_V9: } }
